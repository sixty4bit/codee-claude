# Process Retrospective - February 7, 2026

## Summary
Analyzed 24 hours of Discord activity (Feb 6, 2026). Heavy development day — PRs #186-190 moved through various stages, seminar codes feature designed, DOCX export shipped with bug fixes. **6 friction points identified, 4 successful patterns to codify.**

---

## Friction Points

### 1. Member Route Violation Caught Late (PR #187)
**Problem:** Added `get :download` member route, violating CRUD-only pattern. Carl caught it and requested refactor to nested resource.

**Time wasted:** ~15 minutes for rework

**Proposed Solution:** Pre-commit hook or Claude Code command that validates routes.rb for member/collection routes.

**Implementation:**
```bash
# .claude/commands/validate_routes.md
Run: grep -n "member do\|collection do\|get :\|post :\|put :\|patch :\|delete :" config/routes.rb

If matches found outside of `resources :foo, only: [...]` blocks, flag for review.

Suggest: Convert to nested singular resource pattern
  # Instead of: get :download (member)
  # Use: resource :docx, only: [:show]
```

### 2. Research Doc Duplication Confusion
**Problem:** Two similar files existed: `conversation-transcript.md` (78 lines) and `conversation-transcript-export.md` (447 lines). Unclear which was authoritative.

**Time wasted:** ~5 minutes clarifying

**Proposed Solution:** Enforce single source of truth with dated filenames and `-DRAFT` suffix until approved.

**Implementation:**
- Research docs: `thoughts/shared/research/YYYY-MM-DD-{topic}.md`
- Plans: `thoughts/shared/plans/YYYY-MM-DD-{topic}.md`
- Remove duplicates immediately when found
- Add to `.gitignore` any `-DRAFT` suffix files

### 3. .beads Committed to Wrong Repo
**Problem:** .beads files committed to llapp instead of central codee-claude repo.

**Time wasted:** ~10 minutes cleanup

**Proposed Solution:** Already fixed — added `.beads/` to llapp's `.gitignore`. But need reminder in workflow.

**Implementation:**
Add to `AGENTS.md` or `vibe2win.md`:
```markdown
## Beads Location
All beads stay in `/Users/sia/clawd/personas/codee/codee-claude/.beads/`
Never commit .beads to project repos.
```

### 4. HTML Tags Leaking in DOCX Output
**Problem:** `<b>` tags inside `<li>` items rendered as literal "b" text. Kramdown's `:html_element` returns tag name, not content.

**Time wasted:** ~20 minutes debugging

**Proposed Solution:** Add binary/HTML test fixtures and edge case tests.

**Implementation:**
```ruby
# test/fixtures/files/html_in_tables.md
| Column |
|--------|
| <ul><li><b>Bold item</b></li></ul> |

# test/services/markdown_to_docx_test.rb
test "handles bold tags inside list items in tables" do
  content = "| Cell |\n|------|\n| <ul><li><b>Bold</b> text</li></ul> |"
  result = MarkdownToDocx.new(content).call
  assert_includes result.text_content, "Bold text"
  refute_includes result.text_content, "<b>"
  refute_includes result.text_content, "b"
end
```

### 5. PR/Branch State Confusion
**Problem:** Carl asked "is this work being done on 189 correct?" — unclear which branch held what work.

**Time wasted:** ~5 minutes clarifying

**Proposed Solution:** Status updates should always include current branch and PR number.

**Implementation:**
When reporting status, always format as:
```
**Branch:** feature/seminar-codes
**PR:** #189
**Status:** Implementing phase 3/5
```

### 6. Undo/Redo Loops
**Problem:** Multiple "undo that please" requests followed by reverts. File deletions that shouldn't have happened.

**Time wasted:** ~10 minutes total

**Proposed Solution:** Confirm destructive operations before executing. Use `trash` not `rm`.

**Implementation:**
Add to AGENTS.md enforcement:
```markdown
Before deleting files, confirm:
"About to remove: {file_path}. Confirm? (y/n)"
```

---

## Successful Patterns to Codify

### 1. Sub-Agent Delegation with Clear Handoffs
**Pattern:** "Sub-agent implementing #187 now. Will ping when done."

**Why it works:** 
- Clear ownership transfer
- Main session stays responsive
- Status updates when complete

**Codify as:** Standard sub-agent spawn format.

### 2. Separate PRs for Dependencies
**Pattern:** #190 (partner role) merged before #189 (seminar codes that use partner role).

**Why it works:**
- Smaller, reviewable PRs
- Clear dependency chain
- Easy rollback if issues

**Codify as:** When feature needs new role/permission/model, split into foundation PR first.

### 3. Test-First Bug Fixing
**Pattern:** "Write a test for that, and then fix it."

**Why it works:**
- Reproduces the bug reliably
- Prevents regression
- Documents expected behavior

**Codify as:** Bug fix workflow — failing test first, then fix.

### 4. State-to-Timezone Mapping Without LLM
**Pattern:** Simple lookup table `STATE_TIMEZONES["CA"] => "America/Los_Angeles"`

**Why it works:**
- Zero latency
- Zero cost
- Covers 90%+ of cases
- Can refine later if needed

**Codify as:** Prefer lookup tables over LLM calls for deterministic mappings.

---

## Improvements Queue

### Priority 1: Route Validator Command
Create `.claude/commands/validate_routes.md` that checks for CRUD violations.

### Priority 2: Beads Location Reminder
Add explicit reminder to vibe2win.md about central beads repo.

### Priority 3: HTML Edge Case Test Fixtures
Add `test/fixtures/files/` with edge cases:
- `html_in_tables.md`
- `nested_bold_in_lists.md`
- `mixed_markdown_html.md`

### Priority 4: Status Update Template
Standardize branch/PR/status format in all updates.

---

## Metrics
- **PRs Worked:** 5 (#186, #187, #188, #189, #190)
- **PRs Merged:** 2 (#186, #190)
- **Features Designed:** Seminar codes (rate limit bypass for events)
- **Bugs Fixed:** HTML parsing in DOCX, encoding issues
- **Time Lost to Friction:** ~65 minutes estimated

---

*Generated: 2026-02-07 04:00 PST*
